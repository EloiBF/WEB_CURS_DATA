{
  "curs": {
    "nom": "SQL",
    "descripcio": "Aprèn a dominar SQL des de zero fins a nivell avançat, aplicat a l'anàlisi de dades.",
    "color_fons": "#F4F8F4"
  },
  "capitol": {
    "titol": "CTE (Common Table Expressions) i modularització de consultes",
    "numero": 8,
    "dificultat": "Avançat",
    "preu": 0.0
  },
  "exercicis": [
    {
      "numero": 1,
      "titol": "Introducció a WITH",
      "tipus": "codi",
      "descripcio": "Les Common Table Expressions (CTE) són una manera de definir una consulta temporal que es pot utilitzar dins d'una altra consulta. La clàusula WITH permet definir una CTE. En aquest exercici, has de crear una CTE que seleccioni tots elsregistres de la taula 'emps' on el departament és 'Sales'.",
      "enunciat": "Crea una CTE per seleccionar els empleats del departament de 'Sales'.",
      "solucio": "Resultat de la consulta",
      "solucio_codi_1": "WITH sales_emps AS (SELECT * FROM emps WHERE dept = 'Sales') SELECT * FROM sales_emps;",
      "solucio_codi_2": null,
      "codi_a_completar": null,
      "temps_estimat_minuts": 5,
      "respostes_test": [],
      "pista_1": "Utilitza la clàusula WITH per definir la CTE.",
      "pista_2": "Selecciona tots els registres de la taula 'emps' on el departament és 'Sales'.",
      "imatge_1": null,
      "descripcio_imatge_1": null,
      "imatge_2": null,
      "descripcio_imatge_2": null
    },
    {
      "numero": 2,
      "titol": "Construir consultes modulars",
      "tipus": "codi",
      "descripcio": "Les CTE permeten construir consultes modulars, on cadascuna CTE pot ser una unitat independent de la consulta. En aquest exercici, has de crear dues CTE que seleccionin els registres dels empleats dels departaments 'Sales' i 'Marketing' i després combinar-les en una sola consulta.",
      "enunciat": "Crea dues CTE per seleccionar els empleats dels departaments 'Sales' i 'Marketing' i combina-les en una sola consulta.",
      "solucio": "Resultat de la consulta",
      "solucio_codi_1": "WITH sales_emps AS (SELECT * FROM emps WHERE dept = 'Sales'), marketing_emps AS (SELECT * FROM emps WHERE dept = 'Marketing') SELECT * FROM sales_emps UNION ALL SELECT * FROM marketing_emps;",
      "solucio_codi_2": null,
      "codi_a_completar": null,
      "temps_estimat_minuts": 10,
      "respostes_test": [],
      "pista_1": "Crea dues CTE per seleccionar els registres dels empleats dels departaments 'Sales' i 'Marketing'.",
      "pista_2": "Combina les dues CTE en una sola consulta utilitzant l'operador UNION ALL.",
      "imatge_1": null,
      "descripcio_imatge_1": null,
      "imatge_2": null,
      "descripcio_imatge_2": null
    },
    {
      "numero": 3,
      "titol": "Millorar la llegibilitat amb CTEs",
      "tipus": "codi",
      "descripcio": "Les CTE permeten millorar la llegibilitat de les consultes complexes, separant les diferents parts de la consulta en unitats independents. En aquest exercici, has de crear una CTE per seleccionar els registres dels empleats amb salari superior a la mitjana i després utilitzar-la per calcular la mitjana dels salaris d'aquests empleats.",
      "enunciat": "Crea una CTE per seleccionar els registres dels empleats amb salari superior a la mitjana i calcula la mitjana dels salaris d'aquests empleats.",
      "solucio": "Resultat de la consulta",
      "solucio_codi_1": "WITH high_salary_emps AS (SELECT * FROM emps WHERE salary > (SELECT AVG(salary) FROM emps)) SELECT AVG(salary) FROM high_salary_emps;",
      "solucio_codi_2": null,
      "codi_a_completar": null,
      "temps_estimat_minuts": 10,
      "respostes_test": [],
      "pista_1": "Crea una CTE per seleccionar els registres dels empleats amb salari superior a la mitjana.",
      "pista_2": "Calcula la mitjana dels salaris dels empleats seleccionats.",
      "imatge_1": null,
      "descripcio_imatge_1": null,
      "imatge_2": null,
      "descripcio_imatge_2": null
    },
    {
      "numero": 4,
      "titol": "CTEs recursives bàsiques",
      "tipus": "codi",
      "descripcio": "Les CTEs recursives permeten resoldre problemes que requereixen una recurrència, com per exemple, calcular la jerarquia d'un organigrama. En aquest exercici, has de crear una CTE recursiva per calcular la jerarquia dels empleats d'una empresa.",
      "enunciat": "Crea una CTE recursiva per calcular la jerarquia dels empleats d'una empresa.",
      "solucio": "Resultat de la consulta",
      "solucio_codi_1": "WITH RECURSIVE emp_hierarchy AS (SELECT emp_id, manager_id, 0 AS level FROM emps WHERE manager_id IS NULL UNION ALL SELECT e.emp_id, e.manager_id, level + 1 FROM emps e JOIN emp_hierarchy m ON e.manager_id = m.emp_id) SELECT * FROM emp_hierarchy;",
      "solucio_codi_2": null,
      "codi_a_completar": null,
      "temps_estimat_minuts": 15,
      "respostes_test": [],
      "pista_1": "Crea una CTE recursiva per calcular la jerarquia dels empleats.",
      "pista_2": "Utilitza la clàusula RECURSIVE per definir la CTE recursiva.",
      "imatge_1": null,
      "descripcio_imatge_1": null,
      "imatge_2": null,
      "descripcio_imatge_2": null
    },
    {
      "numero": 5,
      "titol": "Test sobre CTEs",
      "tipus": "test",
      "descripcio": "Aquesta pregunta és un test sobre les CTEs. Has de seleccionar la resposta correcta sobre què és una CTE.",
      "enunciat": "Què és una CTE?",
      "solucio": "Una CTE és una consulta temporal que es pot utilitzar dins d'una altra consulta.",
      "solucio_codi_1": null,
      "solucio_codi_2": null,
      "codi_a_completar": null,
      "temps_estimat_minuts": 2,
      "respostes_test": [
        "Una CTE és una taula temporal",
        "Una CTE és una consulta temporal que es pot utilitzar dins d'una altra consulta",
        "Una CTE és un índex temporal",
        "Una CTE és una vista"
      ],
      "pista_1": "Una CTE és una unitat independent de la consulta.",
      "pista_2": "Una CTE es pot utilitzar dins d'una altra consulta.",
      "imatge_1": null,
      "descripcio_imatge_1": null,
      "imatge_2": null,
      "descripcio_imatge_2": null
    }
  ]
}