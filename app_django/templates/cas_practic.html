{% extends 'base.html' %}
{% load static %}
{% load dict_extras %}

{% block title %}Cas Pr√†ctic{% endblock %}

{% block content %}
<div class="case">
    <div class="case__container">
        <header class="case__header">
            <h2>Cas pr√†ctic del cap√≠tol {{ capitol.numero }}: {{ capitol.titol }}</h2>
            <p class="case__intro">{{ capitol.cas_practic_intro | safe }}</p>
        </header>

        <section class="case__content">
            {% if capitol.cas_practic_enunciat %}
                <article class="case__enunciat">
                    <h3>Enunciat del cas pr√†ctic</h3>
                    <div class="case__text">{{ capitol.cas_practic_enunciat | safe }}</div>
                </article>
            {% endif %}

            {% if capitol.cas_practic_dades %}
                <div class="case__data-section">
                    <h4>Dades proporcionades:</h4>
                    <table class="case__table">
                        <thead>
                            <tr>
                                {% for col in capitol.cas_practic_dades.keys %}
                                    <th>{{ col }}</th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% with capitol.cas_practic_dades|dict_first_key as primera_clau %}
                                {% with capitol.cas_practic_dades|get_item:primera_clau as primera_columna %}
                                    {% for i in primera_columna|length|to_range %}
                                        <tr>
                                            {% for col in capitol.cas_practic_dades.keys %}
                                                <td>{{ capitol.cas_practic_dades|get_item:col|get_index:i }}</td>
                                            {% endfor %}
                                        </tr>
                                    {% endfor %}
                                {% endwith %}
                            {% endwith %}
                        </tbody>
                    </table>
                </div>
            {% endif %}

            <form method="post" class="case__form">
                {% csrf_token %}
                <h4>Escriu la teva proposta de soluci√≥:</h4>
                <textarea name="resposta_usuari" class="case__textarea" rows="10" placeholder="Explica el teu raonament o adjunta codi si cal..."></textarea>

                <div class="case__submit">
                    <button type="submit" class="case__button">Envia la resposta</button>
                </div>
            </form>

            {% if missatge %}
                <div class="case__feedback {% if resposta_correcta %}correcta{% else %}incorrecta{% endif %}">
                    {{ missatge }}
                </div>
            {% endif %}

            {% if resposta_ia %}
                <div class="case__feedback-ia">
                    <h4>Comentari de la IA:</h4>
                    <p>{{ resposta_ia | safe }}</p>
                </div>
            {% endif %}
        </section>

        <footer class="case__footer">
            <a href="{% url 'index_curs' capitol.curs.nom %}" class="case__nav-button">üè† Tornar al curs</a>
        </footer>
    </div>
</div>
{% endblock %}
